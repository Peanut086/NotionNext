name: ğŸš€ Auto Deploy NotionNext

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4

      - name: ğŸ”‘ Deploy via SSH
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.SSH_KEY }}
          port: 27827  # â†â†â† å°±æ˜¯è¿™è¡Œï¼å‘Šè¯‰ Action åˆ«è¿ 22ï¼Œè¿ 27827ï¼
          script: |
            cd /www/wwwroot/NotionNext
            git pull origin main
            docker build --build-arg NEXT_DEBUG=true -t my-app .
            docker rm -f app 2>/dev/null || true
            docker run -d -p 3000:3000 --name app --restart unless-stopped my-app
            echo "âœ… $(date): è‡ªåŠ¨éƒ¨ç½²æˆåŠŸï¼"
